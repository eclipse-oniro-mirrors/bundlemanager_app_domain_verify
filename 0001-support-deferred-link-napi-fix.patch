From 5b0b90847c61a5e09aea7caa8e2adf814e71ace4 Mon Sep 17 00:00:00 2001
From: woohoa <wanghuan36@huawei.com>
Date: Tue, 29 Oct 2024 20:19:46 +0800
Subject: [PATCH] support deferred link napi fix

Change-Id: If7f22258a8affa6ea7d8ec75df22de005b5f0cd4
---
 services/src/manager/deferred_link/ability_filter.cpp           | 2 +-
 services/src/manager/deferred_link/deferred_link_mgr.cpp        | 2 --
 .../src/manager/zidl/app_domain_verify_mgr_service_proxy.cpp    | 2 +-
 test/unittest/services/deferred_link_test/BUILD.gn              | 2 +-
 .../services/deferred_link_test/deferred_link_mgr_test.cpp      | 2 +-
 5 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/services/src/manager/deferred_link/ability_filter.cpp b/services/src/manager/deferred_link/ability_filter.cpp
index 3e8633d..0f2cbbe 100644
--- a/services/src/manager/deferred_link/ability_filter.cpp
+++ b/services/src/manager/deferred_link/ability_filter.cpp
@@ -31,6 +31,6 @@ public:
 };
 std::shared_ptr<AbilityFilter> AbilityFilter::Create()
 {
-    return std::shared_ptr<AbilityFilterImpl>();
+    return std::make_shared<AbilityFilterImpl>();
 }
 }
\ No newline at end of file
diff --git a/services/src/manager/deferred_link/deferred_link_mgr.cpp b/services/src/manager/deferred_link/deferred_link_mgr.cpp
index 5654cc4..bcd3aae 100644
--- a/services/src/manager/deferred_link/deferred_link_mgr.cpp
+++ b/services/src/manager/deferred_link/deferred_link_mgr.cpp
@@ -74,8 +74,6 @@ void DeferredLinkMgr::AgeCacheProcess()
     std::unique_lock<std::mutex> lock(cachesMutex_);
     int64_t now = GetSecondsSince1970ToNow();
     caches_.remove_if([now](const DeferredLinkInfo& linkInfo) {
-        APP_DOMAIN_VERIFY_HILOGD(APP_DOMAIN_VERIFY_MGR_MODULE_SERVICE,
-            "url:%{public}s, now:%{public}lld, timestamp%{public}lld.", linkInfo.url.c_str(), now, linkInfo.timeStamp);
         return now - linkInfo.timeStamp >= MAX_CACHE_TIME;
     });
     if (!caches_.empty()) {
diff --git a/services/src/manager/zidl/app_domain_verify_mgr_service_proxy.cpp b/services/src/manager/zidl/app_domain_verify_mgr_service_proxy.cpp
index 9e90a20..3cc9579 100644
--- a/services/src/manager/zidl/app_domain_verify_mgr_service_proxy.cpp
+++ b/services/src/manager/zidl/app_domain_verify_mgr_service_proxy.cpp
@@ -334,7 +334,7 @@ int AppDomainVerifyMgrServiceProxy::GetDeferredLink(std::string& link)
         AppDomainVerifyMgrInterfaceCode::GET_DEFERRED_LINK, data, reply, option);
     if (error != ERR_NONE) {
         APP_DOMAIN_VERIFY_HILOGE(
-            APP_DOMAIN_VERIFY_MGR_MODULE_CLIENT, "QueryAssociatedBundleNames failed, error: %d", error);
+            APP_DOMAIN_VERIFY_MGR_MODULE_CLIENT, "GetDeferredLink failed, error: %d", error);
     }
     int32_t result = reply.ReadInt32();
     if (result != 0) {
diff --git a/test/unittest/services/deferred_link_test/BUILD.gn b/test/unittest/services/deferred_link_test/BUILD.gn
index 665184a..30375ef 100644
--- a/test/unittest/services/deferred_link_test/BUILD.gn
+++ b/test/unittest/services/deferred_link_test/BUILD.gn
@@ -1,4 +1,4 @@
-# Copyright (C) 2023 Huawei Device Co., Ltd.
+# Copyright (C) 2024 Huawei Device Co., Ltd.
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
diff --git a/test/unittest/services/deferred_link_test/deferred_link_mgr_test.cpp b/test/unittest/services/deferred_link_test/deferred_link_mgr_test.cpp
index 248152b..fe81a2d 100644
--- a/test/unittest/services/deferred_link_test/deferred_link_mgr_test.cpp
+++ b/test/unittest/services/deferred_link_test/deferred_link_mgr_test.cpp
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2023 Huawei Device Co., Ltd.
+ * Copyright (C) 2024 Huawei Device Co., Ltd.
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
-- 
2.25.1

